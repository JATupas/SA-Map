{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHADE Project PH</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/stylesheet-SA-PGA.css' %}">

    <!-- Include Leaflet CSS for the map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

</head>

<body>
    <header>
        <div class="header-container">
            <div class="logo-container">
                <img src="{% static 'images/SHADE LOGO.png' %}" alt="PHIVOLCS Logo" class="logo">
                <div class="text-container">
                    <h2>Philippine Institute of Volcanology and Seismology</h2>
                    <h1>SHADE PH</h1>
                </div>
            </div>
            <nav>
                <a href="{% url 'shade_redesign' %}" class="nav-link">Home</a>
                <a href="#About-section" class="nav-link">About</a>
                <span class="separator">|</span>
                <b href="#" class="nav-link">Register</b>
                <a href="#" class="nav-button">Log In</a>
            </nav>
        </div>
    </header>
    
    <main>
        <section class="Home" id="Home">
            <div class="container1">
                <div class="Title">
                    <h1>SHADE Project PH</h1>
                    <p>Seismic Hazard Assessment for Design Earthquake of the Philippines</p>
                </div>
                
                <div class="container2">
                    <div class="map-card">
                        <div id="map" class="map"></div> <!-- Map placed inside card -->
                    </div>

                    <div class="form">
                        <div class="form-card">
                            <div class="form-header">
                                <img src="{% static 'images/ORC Header.svg' %}" class="card-icon">
                                <h2>Ground Motion Intensity Measures</h2>
                            </div>                                   
                            
                            <div class="form-content">
                                <form id="coordinates-form" method="POST">
                                    {% csrf_token %}
                                    <!-- Current coordinates fields -->
                                    <div class="mb-3">
                                        <label for="longitude" class="form-label">Longitude</label>
                                        <input type="text" id="current-lon" class="form-control" placeholder="0.0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="latitude" class="form-label">Latitude</label>
                                        <input type="text" id="current-lat" class="form-control" placeholder="0.0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="site" class="form-label">Site Classification</label>
                                        <input type="text" id="site" class="form-control" placeholder="A">
                                    </div>
                                </form>                            

                                <div class="site-info">
                                    <h3>Site Information:</h3>
                                    <table class="table">
                                        <tbody>
                                            <tr>
                                                <td class="SA-title">Longitude</td>
                                                <td id="long" class="SA-value">{{ current_coord.lng|default:0.0 }}</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">Latitude</td>
                                                <td id="lat" class="SA-value">{{ current_coord.lat|default:0.0 }}</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">Site Class</td>
                                                <td id="site-class-info" class="SA-value">A</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">SA₁</td>
                                                <td id="sa1-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">SA₀₂</td>
                                                <td id="sa02-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">Tₗ</td>
                                                <td id="tl-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">Fa</td>
                                                <td id="Fa-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">Fv</td>
                                                <td id="Fv-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">SMS</td>
                                                <td id="SMS-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">SM1</td>
                                                <td id="SM1-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">SDS</td>
                                                <td id="SDS-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">SD1</td>
                                                <td id="SD1-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">Ts</td>
                                                <td id="Ts-value" class="SA-value">0.0</td>
                                            </tr>
                                            <tr>
                                                <td class="SA-title">To</td>
                                                <td id="To-value" class="SA-value">0.0</td>
                                            </tr>
                                        </tbody>
                                    </table>
                            </div>
                        
                            <div class="button-group">
                                <button type="button" id="check-data">Check Data</button>
                            </div>
                        </div>
                    </div>

                </div>
                
            </div>
        
            <div id="popup" class="popup" style="display: none;">
            </div>

        </section>

        <section class="background">
        </section>

        {% comment %} <section class="Info_Section1">
                <div class="Section1" id="About-section">
                    <img src="{% static 'images/NO IMAGE DARK.svg' %}" alt="Img 1" class="img2">
                    <div class="text">
                        <!-- <h4>Section title</h4> -->
                        <h5>Title</h5>
                        <p>Nunc, mattis arcu eu ut quisque quam. Nunc rhoncus, arcu venenatis consectetur facilisis. Nibh nibh porttitor lectus sit porta vestibulum. Gravida ultricies ultrices velit adipiscing nec ultricies curabitur adipiscing non. Porttitor feugiat at duis aliquam, viverra et amet. Duis pellentesque integer sem sit. Nisl praesent aliquam tellus metus sem id. Feugiat maecenas sollicitudin sed fusce turpis vel hendrerit. Commodo massa ac justo faucibus faucibus ipsum amet. Arcu tincidunt mattis lectus pellentesque in.</p>
                        <p>Nunc, mattis arcu eu ut quisque quam. Nunc rhoncus, arcu venenatis consectetur facilisis. Nibh nibh porttitor lectus sit porta vestibulum. Gravida ultricies ultrices velit adipiscing nec ultricies curabitur adipiscing non. Porttitor feugiat at duis aliquam, viverra et amet. Duis pellentesque integer sem sit. Nisl praesent aliquam tellus metus sem id. Feugiat maecenas sollicitudin sed fusce turpis vel hendrerit. Commodo massa ac justo faucibus faucibus ipsum amet. Arcu tincidunt mattis lectus pellentesque in.</p>
                    </div>
            </div>
        </section> {% endcomment %}

    </main>

    <footer>
        <nav>
            <a href="#">Our Vision</a>
            <a href="#">Features</a>
            <a href="#">Our Team</a>
            <a href="#">Latest News</a>
            <a href="#">Contact</a>
        </nav>
        <p>Copyright © SHADE PH 2024</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize the map after the page has fully loaded
            var map = L.map('map').setView([13.41, 122.56], 6);  // Set initial coordinates
        
            var marker = null;  // Marker variable to store the current marker on the map
    
            // Add a tile layer to the map
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        
            // Event listener for click on the map (only for setting lat/lon, no immediate AJAX request)
            map.on('click', function(e) {
                var lat = e.latlng.lat;
                var lon = e.latlng.lng;
        
                // Update the latitude and longitude input fields
                document.getElementById('current-lat').value = lat;
                document.getElementById('current-lon').value = lon;
        
                // If a marker exists, remove it
                if (marker) {
                    map.removeLayer(marker);
                }
        
                // Add a new marker at the clicked location
                marker = L.marker([lat, lon]).addTo(map);
            });
    
            // Add functionality to the "Check Data" button (for AJAX to update site information)
            document.getElementById('check-data').addEventListener('click', function() {
                var lat = document.getElementById('current-lat').value;
                var lon = document.getElementById('current-lon').value;
                var site = document.getElementById('site').value;  // Make sure this element exists
    
                // Make sure lat, lon, and site values are available before sending AJAX
                if (lat && lon && site) {
                    $.ajax({
                        type: "POST",
                        url: "{% url 'sa_pga_map' %}",  // Ensure this URL resolves correctly in Django
                        data: {
                            'lat': lat,
                            'lon': lon,
                            'site': site,  // Send the site value as well
                            'csrfmiddlewaretoken': '{{ csrf_token }}',  // Include CSRF token if not exempted
                        },
                        success: function(response) {
                            console.log('Data updated successfully');
                            console.log(response);  // Handle the response from the server
                            // Optionally, you can handle any changes to the UI here (e.g., updating coordinates)
                            document.getElementById('long').textContent = response.current_coord.lon || lat;
                        document.getElementById('lat').textContent = response.current_coord.lat || lon;
                        document.getElementById('site-class-info').textContent = response.site || site;  // Assuming site class info is static for now
        
                            // Optionally, populate other fields like SA₁, SMS, etc.
                            document.getElementById('sa1-value').textContent = response.sa1 || '0.0';
                            document.getElementById('sa02-value').textContent = response.sa02 || '0.0';
                            document.getElementById('tl-value').textContent = response.tl || '0.0';
                            document.getElementById('Fa-value').textContent = response.Fa || '0.0';
                            document.getElementById('Fv-value').textContent = response.Fv || '0.0';
                            document.getElementById('SMS-value').textContent = response.SMS || '0.0';
                            document.getElementById('SM1-value').textContent = response.SM1 || '0.0';
                            document.getElementById('SDS-value').textContent = response.SDS || '0.0';
                            document.getElementById('SD1-value').textContent = response.SD1 || '0.0';
                            document.getElementById('Ts-value').textContent = response.Ts || '0.0';
                            document.getElementById('To-value').textContent = response.To || '0.0';
                        },
                        error: function(xhr, status, error) {
                            console.error('Error occurred while updating data:', error);
                            console.log(xhr.responseText);
                        }
                    });
                } else {
                    alert("Please fill in all required fields before submitting.");
                }
            });
        });
    </script>
    
    

</body>
</html>
